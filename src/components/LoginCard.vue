<template>
  <v-card
    class="mx-auto"
    max-width="400"
  >
    <v-img
      class="align-end text-white"
      height="200"
      src="https://cdn.vuetifyjs.com/images/cards/docks.jpg"
      cover
    >
    <svg preserveAspectRatio="xMidYMid meet" data-bbox="0.417 0.005 434.766 126.029" xmlns="http://www.w3.org/2000/svg" viewBox="0.417 0.005 434.766 126.029" height="127" width="436" data-type="color" role="presentation" aria-hidden="true" aria-label="">
    <g>
        <path fill="#1D1D1B" d="M46.523 6.294 44.04 13.83a27.855 27.855 0 0 1 19.166 26.504c0 15.38-12.526 27.898-27.914 27.898-1.73 0-3.43-.16-5.071-.465v8.06a36.4 36.4 0 0 0 5.071.364c19.777 0 35.862-16.077 35.862-35.842a35.8 35.8 0 0 0-24.63-34.056Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M42.353 44.213c-4.214 0-8.283.639-12.12 1.83v8.423a32.657 32.657 0 0 1 12.12-2.31c18.192 0 32.985 14.785 32.985 32.967 0 18.183-14.792 32.967-32.985 32.967-4.272 0-8.37-.828-12.12-2.309v8.423a40.8 40.8 0 0 0 12.12 1.83c22.566 0 40.934-18.357 40.934-40.91 0-22.555-18.368-40.911-40.934-40.911Z" data-color="1"></path>
        <path fill="#1D1D1B" d="m51.972 23.663-2.325 2.324c3.837 3.834 5.944 8.931 5.944 14.363 0 11.197-9.111 20.303-20.315 20.303-1.743 0-3.444-.218-5.07-.64v3.37c1.627.363 3.327.552 5.07.552 13.006 0 23.599-10.587 23.599-23.585 0-6.303-2.456-12.228-6.917-16.672l.014-.015Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M20.295.325h-7.948V124.64h7.948V.325Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M8.365 34.671H.417v89.969h7.948V34.671Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M32.109 20.177H24.16V124.64h7.949V20.177Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M131.559 38.65h-7.949v87.384h7.949V38.65Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M144.085 26.742h-7.949v99.292h7.949V26.742Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M156.596 1.719h-7.949v124.315h7.949V1.719Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M232.999 59.142c13.892 0 25.197 11.299 25.197 25.182 0 13.884-11.305 25.183-25.197 25.183-3.037 0-6.015-.537-8.834-1.598l1.235-3.282a21.448 21.448 0 0 0 7.599 1.365c11.959 0 21.695-9.73 21.695-21.682 0-11.952-9.736-21.683-21.695-21.683a21.518 21.518 0 0 0-13.223 4.488l-2.136-2.774a24.983 24.983 0 0 1 15.359-5.228v.03Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M242.837 74.797c-20.605 0-37.359-16.744-37.359-37.337 0-20.594 16.754-37.338 37.359-37.338 9.982 0 19.355 3.877 26.417 10.935a37.232 37.232 0 0 1 6.437 8.612l-6.989 3.79a29.746 29.746 0 0 0-5.071-6.796c-5.551-5.548-12.933-8.612-20.794-8.612-16.217 0-29.411 13.187-29.411 29.394S226.62 66.84 242.837 66.84c6.553 0 12.758-2.106 17.931-6.085l4.853 6.288c-6.582 5.069-14.458 7.741-22.784 7.741v.014Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M234.888 42.63c-6.975 0-13.673 1.684-19.675 4.908a38.721 38.721 0 0 0-2.891 1.714c-.029.014-.044.03-.073.044 0 0-.029 0-.029.014-.029.015-.044.03-.073.044-.45.29-.901.595-1.337.9-.465.334-.93.668-1.38 1.017l-.959.726a37.036 37.036 0 0 0 4.81 8.263l1.961-1.408c.364-.276.727-.552 1.105-.814.043-.029.087-.058.116-.087a40.12 40.12 0 0 1 1.017-.682s.029-.015.044-.03a36.603 36.603 0 0 1 2.31-1.35l.087-.044s.029 0 .029-.014c4.578-2.425 9.678-3.689 14.982-3.689 9.271 0 17.64 3.95 23.526 10.239.217.232.421.464.624.697.044.058.088.101.131.16.349.406.698.813 1.032 1.234.072.087.131.174.203.261.175.218.334.436.494.654.087.13.189.261.276.392.233.334.465.668.683 1.017.117.174.218.333.335.508.116.189.247.392.363.58.189.306.363.625.537.945a31.917 31.917 0 0 1 3.982 15.496c0 17.732-14.444 32.167-32.186 32.167-11.567 0-22.305-6.259-28.016-16.323a32.103 32.103 0 0 1-4.17-15.844h-9.533a41.644 41.644 0 0 0 5.42 20.549c7.411 13.042 21.317 21.145 36.313 21.145 23.003 0 41.733-18.705 41.733-41.71 0-23.003-18.716-41.708-41.733-41.708l-.058.029Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M265.65 56.18a31.299 31.299 0 0 1-1.874 2.062 29.005 29.005 0 0 1-5.318 4.197c.203.218.392.435.581.653.043.058.087.102.131.16.348.407.697.813 1.031 1.235.073.087.131.174.204.26.174.219.334.437.494.654.087.131.189.262.276.392.232.334.465.668.683 1.017.116.174.218.334.334.508.116.19.247.392.363.581.189.305.364.625.538.944 0 0 .014.044.029.058a36.676 36.676 0 0 0 6.263-5.039c.392-.392.77-.784 1.148-1.19a42.62 42.62 0 0 0-4.883-6.493Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M370.128 126.034a57.85 57.85 0 0 1-10.782-1.017c-15.127-2.846-28.234-11.4-36.923-24.108-8.69-12.707-11.901-28.029-9.053-43.147 2.848-15.118 11.407-28.217 24.121-36.902 12.715-8.685 28.031-11.894 43.172-9.048 7.004 1.322 13.616 3.863 19.631 7.581l-5.013 8.104a47.985 47.985 0 0 0-16.376-6.332c-12.628-2.367-25.415.305-36.023 7.552-10.607 7.247-17.756 18.182-20.125 30.788-2.368 12.62.305 25.4 7.556 36.002 7.251 10.602 18.193 17.747 30.806 20.114 12.627 2.367 25.415-.305 36.022-7.552 10.608-7.247 17.757-18.182 20.126-30.788 2.586-13.724-.93-27.855-9.62-38.805l7.469-5.925a57.55 57.55 0 0 1 11.523 46.487c-2.848 15.118-11.407 28.218-24.121 36.902-9.693 6.623-20.91 10.065-32.39 10.065v.029Z" data-color="1"></path>
        <path fill="#1D1D1B" d="M370.012 104.961c-4.955 0-9.751-.973-14.27-2.89l1.555-3.66a32.498 32.498 0 0 0 12.715 2.571c17.974 0 32.593-14.61 32.593-32.574 0-17.965-14.619-32.575-32.593-32.575-17.975 0-32.593 14.61-32.593 32.575 0 1.481.101 2.977.305 4.444l-3.938.537a37.9 37.9 0 0 1-.334-4.981c0-20.143 16.405-36.54 36.56-36.54 20.154 0 36.56 16.397 36.56 36.54s-16.406 36.539-36.56 36.539v.014Z" data-color="1"></path>
        <path fill="#FF0068" d="M409.347 51.648c14.269 0 25.836-11.56 25.836-25.821 0-14.261-11.567-25.822-25.836-25.822-14.269 0-25.836 11.561-25.836 25.822 0 14.26 11.567 25.821 25.836 25.821Z" data-color="2"></path>
    </g>
</svg>
      <v-card-title>Flix</v-card-title>
    </v-img>

    <v-card-subtitle class="pt-4">
      Login
    </v-card-subtitle>

    <v-card-text>
      <form>
    <v-text-field
      v-model="state.username"
      label="E-mail"
      required
      
    ></v-text-field>

    <v-text-field
      v-model="state.password"
      label="Senha"
      required
      :type="'password'"
      
    ></v-text-field>


    
  </form>
    </v-card-text>

    <v-card-actions>
      <v-btn
      class="me-4"
      @click="makeLogin"
    >
      submit
    </v-btn>
     <v-btn
      class="me-4"
      @click="goToRegister"
    >
      Register
    </v-btn>
    
    </v-card-actions>
     <v-alert
      v-if="alertVisible"
      :title="msgalert"
      :type="typeAlert"
      dismissible
    ></v-alert>
  </v-card>
  
</template>
<script>

  export default {
    data(){
      return{
        state:{
          username:'',
          password:'',
        },
        msgalert:'',
        typeAlert:'',
        alertVisible:false,
      }
    },
  methods: {
    goToRegister() {
      this.$router.push('/register')
    },
    makeLogin(){
      const formData = new URLSearchParams();
      formData.append('username', this.state.username);
      formData.append('password', this.state.password);
      this.$http.post('/token',formData).then(res=>{
        console.log(res)
        if(res.data.access_token){
              this.alertVisible = true;
              this.typeAlert = 'success';      
              this.msgalert = 'Logando...';
              document.cookie = `tokenApibiso= bearer ${res.data.access_token}; path=/; max-age=3600; secure; samesite=strict'`
              this.$router.push('/Home')
        }else{
                this.alertVisible = true;
                this.typeAlert = 'error';      
                this.msgalert = 'Erro na requisição';
              }
      }).catch(err=>{
        console.log(err)
        try{
        if(err.response.request.status == 401){
                          this.alertVisible = true;
                          this.typeAlert = 'warning';      
                          this.msgalert = 'Email ou senha incorreta';
                  }
        }catch{
                          this.alertVisible = true;
                          this.typeAlert = 'warning';      
                          this.msgalert = 'Erro na requisição';
        }
         

      })
    }
  }
}

  
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped>
h3 {
  margin: 40px 0 0;
}
ul {
  list-style-type: none;
  padding: 0;
}
li {
  display: inline-block;
  margin: 0 10px;
}
a {
  color: #42b983;
}
</style>
